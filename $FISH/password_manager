function password_manager
    set file ~/.passwords.txt

    if not test -e $file
        touch $file
    end

    set cmd $argv[1]

    if test "$cmd" = "-h" -o "$cmd" = "--help"
        echo "🛡️  Simple Password Manager"
        echo "Usage:"
        echo "  password_manager add <site> <username> <password>     Add a new entry"
        echo "  password_manager get <site>                           Get all credentials for a site"
        echo "  password_manager list                                 List all stored sites"
        echo "  password_manager del <site>                           Delete all entries for a site"
        echo "  password_manager update <site> <username> <password>  Update entry for a site + username"
        echo "  password_manager export <file>                        Export all entries"
        echo "  password_manager import <file>                        Import entries from file"
        return 0
    end

    switch $cmd
        case add
            if test (count $argv) -lt 4
                echo "❌ Usage: password_manager add <site> <username> <password>"
                return 1
            end
            set site $argv[2]
            set username $argv[3]
            set password $argv[4]
            echo "$site:$username:$password" >> $file
            echo "✅ Added credentials for '$site'"

        case update
            if test (count $argv) -lt 4
                echo "❌ Usage: password_manager update <site> <username> <password>"
                return 1
            end
            set site $argv[2]
            set username $argv[3]
            set password $argv[4]
            grep -v "^$site:$username:" $file > $file.tmp && mv $file.tmp $file
            echo "$site:$username:$password" >> $file
            echo "🔁 Updated credentials for '$site' and username '$username'"

        case get
            set site $argv[2]
            set results (grep "^$site:" $file)
            if test -n "$results"
                echo "🔐 Stored credentials for '$site':"
                for line in $results
                    set parts (string split ":" $line)
                    echo "👤 Username: $parts[2]"
                    echo "🔑 Password: $parts[3]"
                    echo "----"
                end
            else
                echo "❌ No entries found for '$site'"
            end

        case del
            if test (count $argv) -lt 3
                echo "❌ Usage: password_manager del <site> <username>"
                return 1
            end
            set site $argv[2]
            set username $argv[3]
            grep -v "^$site:$username:" $file > $file.tmp && mv $file.tmp $file
            echo "🗑️  Deleted entry for site '$site' and username '$username'"

        case list
            echo "📋 Stored sites:"
            cut -d: -f1 $file | sort | uniq

        case export
            set export_file $argv[2]
            cp $file $export_file
            echo "📤 Exported to $export_file"

        case import
            set import_file $argv[2]
            cat $import_file >> $file
            echo "📥 Imported from $import_file"

        case '*'
            echo "❌ Unknown command. Use 'password_manager -h' for help."
    end
end
