function password_manager
    set file ~/.passwords.txt

    if not test -e $file
        touch $file
    end

    set cmd $argv[1]

    if test "$cmd" = "-h" -o "$cmd" = "--help"
        echo "🛡️  Simple Password Manager"
        echo "Usage:"
        echo "  password_manager add <site> <username>         Add a new credential"
        echo "  password_manager get <site>                    Get credentials for a site"
        echo "  password_manager update <site> <username>      Update password for a specific username"
        echo "  password_manager del <site> <username>         Delete credentials"
        echo "  password_manager list                          List all saved sites"
        echo "  password_manager export <file>                 Export all passwords"
        echo "  password_manager import <file>                 Import passwords from file"
        return 0
    end

    switch $cmd
	case add
	    if test (count $argv) -lt 3
		echo "❌ Usage: password_manager add <site> <username>"
		return 1
	    end
	    set site $argv[2]
	    set user $argv[3]

	    set password (bash -c 'read -s -p "🔒 Enter password: " pw; echo $pw')
	    echo ""

	    if test -z "$password"
		echo "❌ Password cannot be empty"
		return 1
	    end

    echo "$site:$user:$password" >> $file
    echo "✅ Added credentials for '$site'"

        case update
            if test (count $argv) -lt 3
                echo "❌ Usage: password_manager update <site> <username>"
                return 1
            end
            set site $argv[2]
            set user $argv[3]
            read -p "🔁 New password for $user at $site: " password
            if test -z "$password"
                echo "❌ Password cannot be empty"
                return 1
            end
            grep -v "^$site:$user:" $file > $file.tmp && mv $file.tmp $file
            echo "$site:$user:$password" >> $file
            echo "🔁 Updated password for '$user' on '$site'"

        case get
            if test (count $argv) -lt 2
                echo "❌ Usage: password_manager get <site>"
                return 1
            end
            set site $argv[2]
            set results (grep "^$site:" $file)
            if test -n "$results"
                echo "🔐 Stored credentials for '$site':"
                for line in $results
                    set parts (string split ":" $line)
                    echo "  👤 Username: $parts[2] | 🔑 Password: $parts[3]"
                end
            else
                echo "❌ No credentials found for '$site'"
            end

        case del
            if test (count $argv) -lt 3
                echo "❌ Usage: password_manager del <site> <username>"
                return 1
            end
            set site $argv[2]
            set user $argv[3]
            grep -v "^$site:$user:" $file > $file.tmp && mv $file.tmp $file
            echo "🗑️  Deleted credentials for '$user' on '$site'"

        case list
            echo "📋 Stored sites:"
            cut -d: -f1 $file | sort | uniq

        case export
            set export_file $argv[2]
            cp $file $export_file
            echo "📤 Exported to $export_file"

        case import
            set import_file $argv[2]
            cat $import_file >> $file
            echo "📥 Imported from $import_file"

        case '*'
            echo "❌ Unknown command. Use 'password_manager -h' for help."
    end
end
